<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#121212">
    
    <!-- iOS PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Vault">

    <title>Vault</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css?v=1.1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div class="app-container">
        
        <!-- Screen 1: Login -->
        <div id="login-screen">
            <div class="login-box">
                <h1><i class="fas fa-shield-alt"></i> Vault</h1>
                <p class="subtitle">End-to-End Encrypted & Private</p>
                
                <div class="tabs">
                    <button class="tab-btn active">Join / Create Room</button>
                </div>

                <div class="form-content">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Display Name</label>
                        <input type="text" id="username-input" placeholder="Your Name" autocomplete="off">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-hashtag"></i> Room Name</label>
                        <input type="text" id="room-input" placeholder="e.g. SecretMeeting" autocomplete="off">
                        <small>Share this name with your friends.</small>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-key"></i> Secret PIN (Password)</label>
                        <input type="password" id="password-input" placeholder="6-Digit Code (e.g. 123456)" autocomplete="off" maxlength="20">
                        <small class="secure-note"><i class="fas fa-lock"></i> Used for Encryption. Server never sees this.</small>
                    </div>

                    <button id="join-btn">Enter Room</button>
                </div>
            </div>
        </div>

        <!-- Screen 2: Group Session -->
        <div id="session-screen" class="hidden">
            <!-- Header -->
            <div class="session-header">
                <div class="room-info">
                    <span id="room-display">Room: ...</span>
                    <span class="status secure"><i class="fas fa-lock"></i> E2EE</span>
                </div>
                <div class="header-actions">
                    <button id="join-call-btn" class="btn-primary small pulse"><i class="fas fa-video"></i> Join Call</button>
                    <button id="copy-link-btn" class="btn-secondary small" title="Copy Direct Invite Link"><i class="fas fa-link"></i> Invite</button>
                    <button id="destroy-btn" class="btn-danger small" title="Permanently Destroy Room"><i class="fas fa-bomb"></i> Destroy</button>
                    <button id="leave-btn" class="btn-danger small"><i class="fas fa-sign-out-alt"></i></button>
                </div>
            </div>

            <!-- Video Grid (Hidden by default until call joined) -->
            <div id="video-grid" class="video-grid hidden">
                <div class="video-wrapper local">
                    <video id="local-video" autoplay playsinline muted></video>
                    <span class="video-label">You</span>
                </div>
                <!-- Remote videos injected here -->
            </div>

            <!-- Chat Overlay (Mobile Friendly) -->
            <div id="chat-overlay" class="chat-overlay hidden-mobile">
                <div class="chat-header">
                    <span>Group Chat</span>
                    <button id="close-chat" class="close-btn hidden-desktop"><i class="fas fa-times"></i></button>
                </div>
                
                <div id="messages-container"></div>
                
                <div id="qr-modal" class="qr-modal hidden">
                    <div class="qr-content">
                        <h3>Scan to Join</h3>
                        <div id="qrcode"></div>
                        <p>One-Time Invite Link</p>
                        <button id="close-qr" class="btn-secondary small">Close</button>
                    </div>
                </div>

                <div id="screenshot-warning" class="hidden">
                    <i class="fas fa-exclamation-triangle"></i> SCREENSHOT DETECTED
                </div>

                <div class="input-area">
                    <input type="text" id="message-input" placeholder="Encrypted message..." autocomplete="off">
                    <button id="send-btn"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>

            <!-- Controls (Hidden until call joined) -->
            <div id="controls-bar" class="controls-bar hidden">
                <button id="toggle-mic" class="control-btn active"><i class="fas fa-microphone"></i></button>
                <button id="toggle-cam" class="control-btn active"><i class="fas fa-video"></i></button>
                <button id="toggle-chat" class="control-btn hidden"><i class="fas fa-comment-alt"></i></button>
            </div>

            <!-- Privacy Shield -->
            <div id="privacy-shield" class="hidden">
                <div class="shield-content">
                    <i class="fas fa-user-secret fa-3x"></i>
                    <p>App Hidden</p>
                    <small>Tap to resume</small>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js?v=1.1"></script>
</body>
</html>
